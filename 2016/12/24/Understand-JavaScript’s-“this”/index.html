<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>understand javascript’s “this” | The Girl Behind</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="JavaScript" />
  
  
  
  
  <meta name="description" content="JavaScript scope">
<meta property="og:type" content="article">
<meta property="og:title" content="Understand JavaScript’s “this”">
<meta property="og:url" content="https://dale-.github.io/2016/12/24/Understand-JavaScript’s-“this”/index.html">
<meta property="og:site_name" content="The Girl Behind">
<meta property="og:description" content="JavaScript scope">
<meta property="og:updated_time" content="2016-12-24T15:41:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Understand JavaScript’s “this”">
<meta name="twitter:description" content="JavaScript scope">
  
    <link rel="alternate" href="/atom.xml" title="The Girl Behind" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="../../../../css/style.css">

  <script src="../../../../js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="../../../../css/dialog.css">
  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  

</head>

<body>
  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                
                  <li> <a class="main-nav-link" href="../../../../index.html">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../categories">Categories</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../tags">Tags</a> </li>
                
                  <li> <a class="main-nav-link" href="http://weibo.com/daledu">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '../../../../content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="../../../../js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-Understand-JavaScript’s-“this”" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Understand JavaScript’s “this”
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="" class="article-date">
	  <time datetime="2016-12-24T15:07:55.000Z" itemprop="datePublished">2016-12-24</time>
	</a>

      
    <a class="article-category-link" href="../../../../categories/JavaScript/">JavaScript</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="译-Understand-JavaScript’s-“this”-With-Clarity"><a href="#译-Understand-JavaScript’s-“this”-With-Clarity" class="headerlink" title="[译] Understand JavaScript’s “this” With Clarity"></a>[译] Understand JavaScript’s “this” With Clarity</h2><p>原文地址：<a href="http://javascriptissexy.com/understand-javascripts-this-with-clarity-and-master-it/#" target="_blank" rel="external">Understand JavaScript’s “this” With Clarity, and Master It</a></p>
<h2 id="JavaScript中-this-的基本用法"><a href="#JavaScript中-this-的基本用法" class="headerlink" title="JavaScript中 this 的基本用法"></a>JavaScript中 <code>this</code> 的基本用法</h2><p>首先，我们知道在JavaScript中所有函数像对象一样，都具有属性。当一个函数被执行时，将获得 <code>this</code> 这个属性。而 <code>this</code> 实际上就是一个具有调用函数对象值的变量。</p>
<p>变量 <code>this</code> 通常都是指向一个对象，并拥有这个对象的值。<code>this</code> 通常被用在一个函数或者方法体内，当然它也可以被使用在函数外的全局作用域中。当我们开启严格模式时，<code>this</code> 在全局函数和匿名函数中的值为 <code>undefined</code> ，不指向任何一个对象。</p>
<p><code>this</code>被在函数内使用（函数称为函数A），它包含了能够调用函数A的对象的值。我们需要 <code>this</code> 来获取调用函数A的对象的方法和属性，这在我们不知道函数名字或者函数没有名字的时候去调用对象时，显得尤为重要。实际上，<code>this</code>就是一个祖先对象，或者说是调用函数时的一个指代。</p>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var person = &#123;</div><div class="line">    firstName   :<span class="string">"Penelope"</span>,</div><div class="line">    lastName    :<span class="string">"Barrymore"</span>,</div><div class="line">    // Since the <span class="string">"this"</span> keyword is used inside the showFullName method below, and the showFullName method is defined on the person object,​</div><div class="line">    // <span class="string">"this"</span> will have the value of the person object because the person object will invoke showFullName ()​</div><div class="line">    showFullName:<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">    console.log (this.firstName + <span class="string">" "</span> + this.lastName);</div><div class="line">    &#125;</div><div class="line">​&#125;</div><div class="line">​</div><div class="line">person.showFullName (); // Penelope Barrymore</div></pre></td></tr></table></figure>
<p>我们再来看看jQuery中<strong>this</strong>的基本用法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">   // A very common piece of jQuery code​</div><div class="line">​</div><div class="line">   $ (<span class="string">"button"</span>).click (<span class="keyword">function</span> (event) &#123;</div><div class="line">   // $(this) will have the value of the button ($(<span class="string">"button"</span>)) object​</div><div class="line">​   // because the button object invokes the click () method​</div><div class="line">   console.log ($ (this).prop (<span class="string">"name"</span>));</div><div class="line">   &#125;);&#125;);</div></pre></td></tr></table></figure>
<p>我来解释一下上面jQuery的例子：<em>$(this)</em>是jQuery中使用<em>this</em>的语法同在JavaScript中，它被用在一个匿名函数中，这个匿名函数会执行按钮的click方法。<em>$(this)</em>有button这个对象的原因是jQuery的库中把<code>$(this)</code>和调用click方法的对象手动绑定在一起。。尽管<em>$(this)</em>将会拥有jQuery对象<em>$(“button”)</em>的值，但是在<em>$(this)</em>被定义的函数内，不能得到这个函数外的<em>$(this)</em>变量。</p>
<p>值得注意的，button是一个在HTML中的DOM元素，也是一个对象。在这个例子中button是一个jQuery对象，因为我用jQuery中的<code>$</code>包装了它。</p>
<h2 id="理解Javascript中-this-的关键"><a href="#理解Javascript中-this-的关键" class="headerlink" title="理解Javascript中 this 的关键"></a>理解Javascript中 <code>this</code> 的关键</h2><p>如果你理解了下面关于JavaScript中this的准则，你将更清楚的理解了<strong>“this”</strong>这个关键字：<em>this</em>不会立刻被赋值，直到一个对象调用了<em>this</em>所在的函数。让我们称这个函数为”this Function”。</p>
<h2 id="全局作用域中的-this"><a href="#全局作用域中的-this" class="headerlink" title="全局作用域中的 this"></a>全局作用域中的 <code>this</code></h2><p>在全局作用域中，当code执行在浏览器端时，所有全局变量和函数都被定义在window这个对象上。因此，当我们在全局作用域中使用<em>this</em>时，它会指向的全局window对象并拥有它的值（除非在严格模式下），这是<em>this</em>就是JavaScript应用和web page的主要容器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">var firstName = <span class="string">"Peter"</span>,</div><div class="line">    lastName = <span class="string">"Ally"</span>;</div><div class="line">​</div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">showFullName</span></span> () &#123;</div><div class="line">// <span class="string">"this"</span> inside this <span class="keyword">function</span> will have the value of the window object​</div><div class="line">// because the showFullName () <span class="keyword">function</span> is defined <span class="keyword">in</span> the global scope, just like the firstName and lastName​</div><div class="line">console.log (this.firstName + <span class="string">" "</span> + this.lastName);</div><div class="line">&#125;</div><div class="line">​</div><div class="line">var person = &#123;</div><div class="line">  firstName   :<span class="string">"Penelope"</span>,</div><div class="line">  lastName    :<span class="string">"Barrymore"</span>,</div><div class="line">  showFullName:<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">  // <span class="string">"this"</span> on the line below refers to the person object, because the showFullName <span class="keyword">function</span> will be invoked by person object.​</div><div class="line">  console.log (this.firstName + <span class="string">" "</span> + this.lastName);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">​</div><div class="line">showFullName (); // Peter Ally​</div><div class="line">​</div><div class="line">// window is the object that all global variables and <span class="built_in">functions</span> are defined on, hence:​</div><div class="line">window.showFullName (); // Peter Ally​</div><div class="line">​</div><div class="line">// <span class="string">"this"</span> inside the showFullName () method that is defined inside the person object still refers to the person object, hence:​</div><div class="line">person.showFullName (); // Penelope Barrymore</div></pre></td></tr></table></figure>
<h2 id="this-最容易被误解的情景"><a href="#this-最容易被误解的情景" class="headerlink" title="this 最容易被误解的情景"></a><code>this</code> 最容易被误解的情景</h2><p><code>this</code> 最容易被误解的关键：当我们借用一个<code>this</code>的方法，当我们把<code>this</code>的方法赋值给一个变量，当使用了包含<br><code>this</code>的方法作为回调传入，当<code>this</code>在闭包中被使用。我们将重现每个场景，并且给出相对适当的解决方案在每个案例中。</p>
<h3 id="在我们继续重现场景前，先讨论下“上下文”这个概念"><a href="#在我们继续重现场景前，先讨论下“上下文”这个概念" class="headerlink" title="在我们继续重现场景前，先讨论下“上下文”这个概念"></a>在我们继续重现场景前，先讨论下“上下文”这个概念</h3><blockquote>
<p>在JavaScript中的上线文接近英文中主语的概念”John is the winner who returned the money.””这句话的主语是John，然后我们可以说这句话的上下文就是John，因为整句话我们都聚焦在John身上。代词”Who”也是指代John。就想我们可以用分号切换一句话的主题一样，我们也可以用这个上下文切换我们调用函数的主题。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">var person = &#123;</div><div class="line">   firstName   :<span class="string">"Penelope"</span>,</div><div class="line">   lastName    :<span class="string">"Barrymore"</span>,</div><div class="line">   showFullName:<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">// The <span class="string">"context"</span></div><div class="line">console.log (this.firstName + <span class="string">" "</span> + this.lastName);</div><div class="line"> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// The <span class="string">"context"</span>, when invoking showFullName, is the person object, when we invoke the showFullName () method on the person object.</div><div class="line">// And the use of <span class="string">"this"</span> inside the showFullName() method has the value of the person object,</div><div class="line">person.showFullName (); // Penelope Barrymore</div><div class="line"></div><div class="line">// If we invoke showFullName with a different object:</div><div class="line">var anotherPerson = &#123;</div><div class="line">firstName   :<span class="string">"Rohit"</span>,</div><div class="line">lastName    :<span class="string">"Khan"</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">// We can use the apply method to <span class="built_in">set</span> the <span class="string">"this"</span> value explicitly—more on the apply () method later.</div><div class="line">// <span class="string">"this"</span> gets the value of whichever object invokes the <span class="string">"this"</span> Function, hence:</div><div class="line">person.showFullName.apply (anotherPerson); // Rohit Khan</div><div class="line"></div><div class="line">// So the context is now anotherPerson because anotherPerson invoked the person.showFullName ()  method by virtue of using the apply () method</div></pre></td></tr></table></figure>
<h3 id="1-Fix-含有this的函数中作为回调被使用"><a href="#1-Fix-含有this的函数中作为回调被使用" class="headerlink" title="1.Fix 含有this的函数中作为回调被使用"></a>1.Fix 含有<code>this</code>的函数中作为回调被使用</h3><p>当我们将包含this的方法作为回调去使用时，这往往变得很难以理解。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// We have a simple object with a clickHandler method that we want to use when a button on the page is clicked</div><div class="line">var user = &#123;</div><div class="line">data:[</div><div class="line">&#123;name:<span class="string">"T. Woods"</span>, age:37&#125;,</div><div class="line">&#123;name:<span class="string">"P. Mickelson"</span>, age:43&#125;</div><div class="line">],</div><div class="line">clickHandler:<span class="keyword">function</span> (event) &#123;</div><div class="line">var randomNum = ((Math.random () * 2 | 0) + 1) - 1; // random number between 0 and 1</div><div class="line"></div><div class="line">// This line is printing a random person<span class="string">'s name and age from the data array</span></div><div class="line">console.log (this.data[randomNum].name + " " + this.data[randomNum].age);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// The button is wrapped inside a jQuery $ wrapper, so it is now a jQuery object</div><div class="line">// And the output will be undefined because there is no data property on the button object</div><div class="line">$ ("button").click (user.clickHandler); // Cannot read property '0<span class="string">' of undefined</span></div></pre></td></tr></table></figure>
<p>上面的代码中可以知道，我们调用了$(“button”)这个对象的click方法，并且将user的clickHandler<br>方法作为回调传入click方法中，不难发现user的clickHandler方法，这时user.clickHandler方法中的<br><code>this</code>已经不再指向user这个对象。因为<code>this</code>被定义在user.clickHandler中，所以<code>this</code>现在指向<br>那个调用user.clickHandler方法的对象。这个调用user.clickHandler的对象是button这个对象，<br>user.clickHandler将会在button的click方法被执行。</p>
<p>由于上面这个观点，当上下文改变的时候，也就是当我们在一些其他对象上执行一个方法的时候<code>this</code>关键字不在<br>指向原始的对象，而是指向调用的这个方法的对象。</p>
<p>解决<code>this</code>被作为回调这个现象的方法：<br>我们可以使用Bind(),Apply()或者Call()方法显示设置<code>this</code>的值，这样我们的<code>this.data</code>就会指向<br>user对象的data属性了。</p>
<p>所以，原来下面这行代码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ (<span class="string">"button"</span>).click (user.clickHandler);</div></pre></td></tr></table></figure></p>
<p>我们用bind方法，将user对象和clickHandler方法绑定起来：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">"button"</span>).click (user.clickHandler.bind (user)); // P. Mickelson 43</div></pre></td></tr></table></figure></p>
<p><a href="http://jsbin.com/exanul/1/edit?html,js,output" target="_blank" rel="external">View a working example of this on JSBin</a></p>
<h3 id="2-Fix-this-在闭包中的情景"><a href="#2-Fix-this-在闭包中的情景" class="headerlink" title="2.Fix this 在闭包中的情景"></a>2.Fix <code>this</code> 在闭包中的情景</h3><p><code>this</code>在闭包中使用时另一个容易误解的例子。值得注意的是，闭包是不能得到外层函数的<code>this</code>变量通过使用<code>this</code>关键字，<br>因为<code>this</code>变量只能通过函数本身得到，而不是内层函数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">var user = &#123;</div><div class="line">tournament:<span class="string">"The Masters"</span>,</div><div class="line">data      :[</div><div class="line">&#123;name:<span class="string">"T. Woods"</span>, age:37&#125;,</div><div class="line">&#123;name:<span class="string">"P. Mickelson"</span>, age:43&#125;</div><div class="line">],</div><div class="line"></div><div class="line">clickHandler:<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">// the use of this.data here is fine, because <span class="string">"this"</span> refers to the user object, and data is a property on the user object.</div><div class="line"></div><div class="line">this.data.forEach (<span class="keyword">function</span> (person) &#123;</div><div class="line">// But here inside the anonymous <span class="keyword">function</span> (that we pass to the <span class="keyword">for</span>Each method), <span class="string">"this"</span> no longer refers to the user object.</div><div class="line">// This inner <span class="keyword">function</span> cannot access the outer <span class="keyword">function</span><span class="string">'s "this"</span></div><div class="line"></div><div class="line">console.log ("What is This referring to? " + this); //[object Window]</div><div class="line"></div><div class="line">console.log (person.name + " is playing at " + this.tournament);</div><div class="line">// T. Woods is playing at undefined</div><div class="line">// P. Mickelson is playing at undefined</div><div class="line">&#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">user.clickHandler(); // What is "this" referring to? [object Window]</div></pre></td></tr></table></figure>
<p><code>this</code>在一个匿名函数中时，是不能通过外层函数的<code>this</code>得到的，所以当没有使用严格模式的时候，<br>它被绑定在全局window对象上。</p>
<p>我们可以这样维持<code>this</code>在匿名函数中：</p>
<p>为了fix这个问题，我们需要在匿名函数的forEach中使用<code>this</code>前，使用一个通用的实践，<br>在我们执行forEach前，将<code>this</code>赋值给其他变量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">var user = &#123;</div><div class="line">   tournament:<span class="string">"The Masters"</span>,</div><div class="line">   data      :[</div><div class="line">   &#123;name:<span class="string">"T. Woods"</span>, age:37&#125;,</div><div class="line">   &#123;name:<span class="string">"P. Mickelson"</span>, age:43&#125;</div><div class="line">   ],</div><div class="line"></div><div class="line">   clickHandler:<span class="keyword">function</span> (event) &#123;</div><div class="line">   // To capture the value of <span class="string">"this"</span> when it refers to the user object, we have to <span class="built_in">set</span> it to another variable here:</div><div class="line">   // We <span class="built_in">set</span> the value of <span class="string">"this"</span> to theUserObj variable, so we can use it later</div><div class="line">   var theUserObj = this;</div><div class="line">   this.data.forEach (<span class="keyword">function</span> (person) &#123;</div><div class="line">   // Instead of using this.tournament, we now use theUserObj.tournament</div><div class="line">   console.log (person.name + <span class="string">" is playing at "</span> + theUserObj.tournament);</div><div class="line">   &#125;)</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   &#125;</div><div class="line"></div><div class="line">   user.clickHandler();</div><div class="line">   // T. Woods is playing at The Masters</div><div class="line">   //  P. Mickelson is playing at The Masters</div></pre></td></tr></table></figure>
<p>值得注意的，许多JavaScript的开发者喜欢用一个名字为<code>that</code>的变量接受<code>this</code>的值，像下面提到的那样。<br>但是与我来说<code>that</code>是一个没有意义的名字，所以我尽量将一个变量命名可以描述出<code>this</code>的指向，所以上述代码中<br>我使用了<code>var theUserObj = this</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// A common practice amongst JavaScript users is to use this code​</div><div class="line">var that = this;</div></pre></td></tr></table></figure>
<p><a href="http://jsbin.com/ibohiw/1/edit?html,js,output" target="_blank" rel="external">View a working example of this on JSBin</a></p>
<h3 id="3-Fix-this上的方法赋值给一个变量"><a href="#3-Fix-this上的方法赋值给一个变量" class="headerlink" title="3.Fix this上的方法赋值给一个变量"></a>3.Fix <code>this</code>上的方法赋值给一个变量</h3><p>当我们使用<code>this</code>变量去赋值一个方法时，<code>this</code>的值可能会超出我们想象地指向其他对象。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">// This data variable is a global variable</div><div class="line">var data = [</div><div class="line">&#123;name:<span class="string">"Samantha"</span>, age:12&#125;,</div><div class="line">&#123;name:<span class="string">"Alexis"</span>, age:14&#125;</div><div class="line">];</div><div class="line"></div><div class="line">var user = &#123;</div><div class="line">// this data variable is a property on the user object</div><div class="line">data    :[</div><div class="line">&#123;name:<span class="string">"T. Woods"</span>, age:37&#125;,</div><div class="line">&#123;name:<span class="string">"P. Mickelson"</span>, age:43&#125;</div><div class="line">],</div><div class="line">showData:<span class="keyword">function</span> (event) &#123;</div><div class="line">var randomNum = ((Math.random () * 2 | 0) + 1) - 1; // random number between 0 and 1</div><div class="line"></div><div class="line">// This line is adding a random person from the data array to the text field</div><div class="line">console.log (this.data[randomNum].name + <span class="string">" "</span> + this.data[randomNum].age);</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">// Assign the user.showData to a variable</div><div class="line">var showUserData = user.showData;</div><div class="line"></div><div class="line">// When we execute the showUserData <span class="keyword">function</span>, the values printed to the console are from the global data array, not from the data array <span class="keyword">in</span> the user object</div><div class="line">//</div><div class="line">showUserData (); // Samantha 12 (from the global data array)</div></pre></td></tr></table></figure>
<p>解决方案：<br>同1的解决方案，利用bind方法显示地设置<code>this</code>的值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// Bind the showData method to the user object</div><div class="line">var showUserData = user.showData.bind (user);</div><div class="line"></div><div class="line">// Now we get the value from the user object, because the this keyword is bound to the user object</div><div class="line">showUserData (); // P. Mickelson 43</div></pre></td></tr></table></figure>
<h3 id="4-Fix-当借用方法的时候-this-的值不正确的问题"><a href="#4-Fix-当借用方法的时候-this-的值不正确的问题" class="headerlink" title="4.Fix 当借用方法的时候 this 的值不正确的问题"></a>4.Fix 当借用方法的时候 this 的值不正确的问题</h3><p>借用方法在JavaScript开发中是很常见的，作为JavaScript的开发者，我们将会经常遇到这种现象。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">// We have two objects. One of them has a method called avg () that the other doesn<span class="string">'t have</span></div><div class="line">// So we will borrow the (avg()) method</div><div class="line">var gameController = &#123;</div><div class="line">	scores: [20, 34, 55, 46, 77],</div><div class="line">	avgScore: null,</div><div class="line">	players: [</div><div class="line">		&#123;name: "Tommy", playerID: 987, age: 23&#125;,</div><div class="line">		&#123;name: "Pau", playerID: 87, age: 33&#125;</div><div class="line">	]</div><div class="line">&#125;</div><div class="line">var appController = &#123;</div><div class="line">	scores: [900, 845, 809, 950],</div><div class="line">	avgScore: null,</div><div class="line">	avg: function() &#123;</div><div class="line">		var sumOfScores = this.scores.reduce(function(prev, cur, index, array) &#123;</div><div class="line">			return prev + cur;</div><div class="line">		&#125;);</div><div class="line">		this.avgScore = sumOfScores / this.scores.length;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//If we run the code below,</div><div class="line">// the gameController.avgScore property will be set to the average score from the appController object "scores" array</div><div class="line"></div><div class="line">// Don't run this code, <span class="keyword">for</span> it is just <span class="keyword">for</span> illustration; we want the appController.avgScore to remain null</div><div class="line"></div><div class="line">gameController.avgScore = appController.avg();</div></pre></td></tr></table></figure>
<p>avg函数中<code>this</code>这个关键字不再指向gameController这个对象，它将会指向appController对象因为它是在appController上调用的。<br>为了fix这个问题并且确定 appController.avg()方法内部的this指向gameController，我们使用apply()方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// Note that we are using the apply () method, so the 2nd argument has to be an array—the arguments to pass to the appController.avg () method.​</div><div class="line">appController.avg.apply (gameController, gameController.scores);</div><div class="line">​</div><div class="line">// The avgScore property was successfully <span class="built_in">set</span> on the gameController object, even though we borrowed the avg () method from the appController object​</div><div class="line">console.log (gameController.avgScore); // 46.4​</div><div class="line">​</div><div class="line">// appController.avgScore is still null; it was not updated, only gameController.avgScore was updated​</div><div class="line">console.log (appController.avgScore); // null</div></pre></td></tr></table></figure>
<p>gameController对象借用appController的avg方法。appController中<code>this</code>的值将会被set到gameController对象，<br>因为我们把gameController作为第一个参数传入了apply方法。apply方法的第一个参数，将会被显示地设置为<code>this</code>的值。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>我希望看完这篇文章后，你对JavaScript中的this关键字有足够的理解。现在你可以使用（bing, apply, and call, and setting this<br>to a variable）来帮助你解决各种情况下的<code>this</code>问题。</p>
<p>正如我们在上面看到的，<code>this</code>在很多情况下都会难以理解，比如上下文发生改变的时候，特别是在回调函数中，或者被另一个对象调用的时候，<br>或是当借用芳芳的时候。永远记得<code>this</code>具有调用<code>this</code>方法的对象的值。</p>
<p>Enjoy Coding.</p>
<p><a href="http://www.tuicool.com/articles/UfamIn2" target="_blank" rel="external">中文翻译</a></p>

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/JavaScript/">JavaScript</a></li></ul>

    </div>
    <footer class="article-footer">
      
        
	<div id="comment">

	<!-- 多说评论框 start -->
	 <div class="ds-thread" data-thread-key="/2016/12/24/Understand-JavaScript’s-“this”/" data-title="Understand JavaScript’s “this”" data-url="https://dale-.github.io/2016/12/24/Understand-JavaScript’s-“this”/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"daledu"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0]
	     || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
	  </script>
	<!-- 多说公共JS代码 end -->

	</div>


      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="../../21/BOM-DOM/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">BOM And DOM</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#译-Understand-JavaScript’s-“this”-With-Clarity"><span class="toc-number">1.</span> <span class="toc-text">[译] Understand JavaScript’s “this” With Clarity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaScript中-this-的基本用法"><span class="toc-number">2.</span> <span class="toc-text">JavaScript中 this 的基本用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#理解Javascript中-this-的关键"><span class="toc-number">3.</span> <span class="toc-text">理解Javascript中 this 的关键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#全局作用域中的-this"><span class="toc-number">4.</span> <span class="toc-text">全局作用域中的 this</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#this-最容易被误解的情景"><span class="toc-number">5.</span> <span class="toc-text">this 最容易被误解的情景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在我们继续重现场景前，先讨论下“上下文”这个概念"><span class="toc-number">5.1.</span> <span class="toc-text">在我们继续重现场景前，先讨论下“上下文”这个概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Fix-含有this的函数中作为回调被使用"><span class="toc-number">5.2.</span> <span class="toc-text">1.Fix 含有this的函数中作为回调被使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Fix-this-在闭包中的情景"><span class="toc-number">5.3.</span> <span class="toc-text">2.Fix this 在闭包中的情景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Fix-this上的方法赋值给一个变量"><span class="toc-number">5.4.</span> <span class="toc-text">3.Fix this上的方法赋值给一个变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Fix-当借用方法的时候-this-的值不正确的问题"><span class="toc-number">5.5.</span> <span class="toc-text">4.Fix 当借用方法的时候 this 的值不正确的问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结语"><span class="toc-number">6.</span> <span class="toc-text">结语</span></a></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      <div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2015 - 2016 The Girl Behind All Rights Reserved.</p>
	      <p id="copyRightCn">Dale Du hold copyright</p>
	</div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../../../../categories" class="mobile-nav-link">Categories</a>
  
    <a href="../../../../tags" class="mobile-nav-link">Tags</a>
  
    <a href="http://weibo.com/daledu" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.css">
  <script src="../../../../fancybox/jquery.fancybox.pack.js"></script>


<script src="../../../../js/script.js"></script>
<script src="../../../../js/bootstrap.js"></script>




  <script src="../../../../js/dialog.js"></script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            The Girl Behind
          </div>
          <div class="panel-body">
            Copyright © 2016 Dale Du All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  

	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


</body>
</html>